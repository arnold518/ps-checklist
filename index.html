<!DOCTYPE html>
<html>
<head>
  <title>My Checklist</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
    .item { display: flex; align-items: center; margin: 10px 0; padding: 10px; border: 1px solid #eee; }
    .completed { text-decoration: line-through; color: #888; }
    button { margin-top: 20px; padding: 8px 16px; }
  </style>
</head>
<body>
  <h1>My Interactive Checklist</h1>
  <div id="checklist"></div>
  <button id="saveBtn">Save Changes</button>

  <script>
    // Configuration
    const JSON_URL = 'https://raw.githubusercontent.com/arnold518/ps-checklist/test/checklist.json';
    const LOCAL_STORAGE_KEY = 'checklistData';
    
    // DOM Elements
    const checklistEl = document.getElementById('checklist');
    const saveBtn = document.getElementById('saveBtn');

    // Load data from GitHub or localStorage
    async function loadData() {
      try {
        // Try to fetch latest from GitHub
        const response = await fetch(JSON_URL);
        const remoteData = await response.json();
        
        // Merge with local changes if any
        const localData = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY));
        const data = localData ? {...remoteData, items: mergeItems(remoteData.items, localData.items)} : remoteData;
        
        renderChecklist(data.items);
        return data;
      } catch (error) {
        console.error("Error loading data:", error);
        const localData = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY));
        if (localData) {
          renderChecklist(localData.items);
          return localData;
        }
        return { items: [] };
      }
    }

    // Merge remote and local items
    function mergeItems(remoteItems, localItems) {
      return remoteItems.map(remoteItem => {
        const localItem = localItems.find(item => item.id === remoteItem.id);
        return localItem || remoteItem;
      });
    }

    // Render checklist items
    function renderChecklist(items) {
      checklistEl.innerHTML = items.map(item => `
        <div class="item ${item.completed ? 'completed' : ''}">
          <input type="checkbox" 
                 ${item.completed ? 'checked' : ''} 
                 data-id="${item.id}">
          ${item.text}
        </div>
      `).join('');

      // Add event listeners
      document.querySelectorAll('#checklist input').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const id = parseInt(this.dataset.id);
          items.find(item => item.id === id).completed = this.checked;
          this.parentElement.classList.toggle('completed');
          saveLocally(items);
        });
      });
    }

    // Save to localStorage
    function saveLocally(items) {
      const data = { 
        items,
        lastUpdated: new Date().toISOString()
      };
      localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(data));
    }

    // Save to GitHub (requires GitHub API - advanced)
    async function saveToGitHub() {
      alert("For a real implementation, you'd need to:\n1. Create a backend API\n2. Use GitHub's API with a token\n3. Never expose the token in frontend code!");
      // This would be handled by a separate Netlify function or similar
    }

    // Initialize
    loadData();
    saveBtn.addEventListener('click', saveToGitHub);
  </script>
</body>
</html>