<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GitHub-Powered Checklist</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    .item {
      display: flex;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #eee;
    }
    .completed {
      text-decoration: line-through;
      color: #888;
    }
    #add-item {
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }
    button {
      padding: 8px 16px;
      cursor: pointer;
    }
    #status {
      margin-top: 10px;
      min-height: 20px;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>My Checklist</h1>
  <div id="checklist"></div>
  
  <div id="add-item">
    <input type="text" id="new-item" placeholder="New item...">
    <button onclick="addItem()">Add</button>
  </div>
  
  <div id="status"></div>
  <button onclick="saveChanges()" style="margin-top: 20px;">Save to GitHub</button>

  <script>
    // Configuration
    const REPO_OWNER = 'arnold518';
    const REPO_NAME = 'ps-checklist';
    const FILE_PATH = 'checklist.json';
    let currentData = { items: [] };
    let githubToken = '';
    let fileSha = '';

    // DOM Elements
    const checklistEl = document.getElementById('checklist');
    const statusEl = document.getElementById('status');

    // Initialize
    loadChecklist();

    // Load checklist from GitHub
    async function loadChecklist() {
      try {
        statusEl.textContent = 'Loading...';
        
        // Get token (in a real app, use a backend or GitHub OAuth)
        githubToken = prompt('Enter your GitHub personal access token (requires repo scope)');
        if (!githubToken) return;
        
        // Fetch current file
        const response = await fetch(
          `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`,
          {
            headers: {
              'Authorization': `token ${githubToken}`,
              'Accept': 'application/vnd.github.v3+json'
            }
          }
        );
        
        if (!response.ok) throw new Error('Failed to load');
        
        const fileData = await response.json();
        fileSha = fileData.sha;
        currentData = JSON.parse(atob(fileData.content));
        
        renderChecklist();
        statusEl.textContent = 'Loaded from GitHub';
      } catch (error) {
        statusEl.textContent = `Error: ${error.message}`;
        console.error(error);
      }
    }

    // Render checklist items
    function renderChecklist() {
      checklistEl.innerHTML = currentData.items.map(item => `
        <div class="item ${item.completed ? 'completed' : ''}">
          <input type="checkbox" 
                 ${item.completed ? 'checked' : ''} 
                 onchange="toggleItem(${item.id})">
          <span>${item.text}</span>
          <button onclick="removeItem(${item.id})" style="margin-left: auto;">Ã—</button>
        </div>
      `).join('');
    }

    // Toggle item completion
    function toggleItem(id) {
      const item = currentData.items.find(i => i.id === id);
      if (item) item.completed = !item.completed;
      statusEl.textContent = 'Changes not saved yet';
    }

    // Add new item
    function addItem() {
      const input = document.getElementById('new-item');
      const text = input.value.trim();
      if (!text) return;
      
      const newId = currentData.items.length > 0 
        ? Math.max(...currentData.items.map(i => i.id)) + 1 
        : 1;
      
      currentData.items.push({
        id: newId,
        text: text,
        completed: false
      });
      
      input.value = '';
      renderChecklist();
      statusEl.textContent = 'Changes not saved yet';
    }

    // Remove item
    function removeItem(id) {
      currentData.items = currentData.items.filter(i => i.id !== id);
      renderChecklist();
      statusEl.textContent = 'Changes not saved yet';
    }

    // Save changes to GitHub
    async function saveChanges() {
      try {
        statusEl.textContent = 'Saving...';
        
        const response = await fetch(
          `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`,
          {
            method: 'PUT',
            headers: {
              'Authorization': `token ${githubToken}`,
              'Accept': 'application/vnd.github.v3+json',
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              message: 'Update checklist',
              content: btoa(JSON.stringify(currentData, null, 2)),
              sha: fileSha
            })
          }
        );
        
        if (!response.ok) throw new Error('Failed to save');
        
        const result = await response.json();
        fileSha = result.content.sha;
        statusEl.textContent = 'Saved to GitHub!';
      } catch (error) {
        statusEl.textContent = `Error: ${error.message}`;
        console.error(error);
      }
    }
  </script>
</body>
</html>